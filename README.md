# Will-U Project (**2023/08/16 ~ 2023/09/18)**

---

> 👯‍♀️ 무엇이든 누군가와 함께 하고 싶을 때, 함께 할 친구를 찾을 수 있는 사이트
> 

## 프로젝트 소개

---

> 🔎 무언가 하고 싶을때 함께 할 인원 모집, 검색, 채팅을 통한 유저 연결 및 알림 제공 사이트 입니다.
> 

## ⚙ 개발환경

---

- `Spring boot`
- `Java 17`
- `JDK 17.0.7`
- `MySQL 8.0`

## ⚙ 사용기술

---

- `JPA`
- `EC2`
- `S3`
- `RDS`
- `Redis`
- `Spring Security`
- `JWT`
- `Oauth2`
- `SSE`
- `STOMP`
- `Sring batch`
- `QueryDSL`

### 🛠 서비스 아키텍처

![할래 아키텍처.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/182f19c9-43e9-4f68-9073-da43faf966c4/572d4bb0-e6b6-4939-8c4d-0128dd63d5d7/%ED%95%A0%EB%9E%98_%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png)

## ✨기능 소개

---

### 1. 사용자

- 회원 가입
- springSecurity 적용
- jwt토큰 (Cookie) 적용
- refreshToken 적용
- 로그인
    - 일반 (자체) 로그인
    - 소셜 로그인
        - 카카오 로그인
- 로그아웃
    - redis를 사용한 토큰 로그아웃
- 회원탈퇴
- 프론트 - 로그인 필요 페이지 접근 시 로그인 페이지로 이동

### 2. 마이 페이지 기능

- 리뷰 CRUD
- 사용자 점수 조회
    - 사용자 신뢰도 판단
- 관심/ 차단 유저 등록
- 프로필 수정
    - s3 프로필 사진 수정
    - 닉네임 수정

### 3. 게시글 (모집글)

- 모집 글 작성
    - 장소 저장에 지도 API 사용
- 모집글 조회 (페이징 적용)
- 모집 글 수정
- 모집 글 삭제
- 모집 글 검색
    - 페이징 적용
    - 검색 글자수 2글자 이상으로 제한
    - 검색 조건 : 제목(default), 내용, 글쓴이, 모집중인 것만(default=false)
- 해시태그
    - 페이징 적용
    - 검색 조건: 2글자의 문자열, 모집중인 것만(default=false)
- 모집 상태 변경
- 페이징 기능
    - 게시글 1~10까지 자동 페이징
    - 검색에도 적용
- 프론트 - 작성자와 신청자의 화면 차별 적용
    - 게시글 상세페이지, 프로필 상세페이지, 채팅방

### 4. 채팅 기능

- 실시간 메세지 송/수신
    - STOMP를 사용한 소켓연결
    - STOMP의 pub, sub 기능 으로 메세지 송/수신
    - SockJS를 이용한 여러 브라우저 호환
- 채팅방 데이터 저장
    - 사용자가 채팅방 접속시 채팅방 아이디를 구독
    - 구독 데이터를 테이블에 저장
- 채팅방에 속한 사용자 저장
    - 소켓 연결시 사용자 정보 저장
    - 사용자가 초대된 시간 저장
    - 사용자가 속한 채팅방이 아니면 접속 불가
- 채팅방 조회
    - 사용자가 속한 채팅방만 조회
    - 채팅방이 활성화 되어있는 방만 조회
    - 비활성화 채팅방 접속 불가
- 채팅 저장
    - 채팅이 송신된 시간과 내용 저장
    - 사용자가 채팅방에 초대된 시간 과 비교 후 데이터 조회
- 채팅방 사용자 모집
    - 신청을 허락한 사용자의 데이터를 저장
    - 만남 완료 시간이 지나면 '게시글' 모집 상태 변경, '채팅방' 비활성화
- 사용자 강퇴
    - 채팅방 방장이 사용자 강퇴
    - 해당 추방자의 채팅 제재
    - 유저목록 반영
- 채팅방 나가기

### 5. 알림 기능

- SSE 연결
    - 클라이언트에서 SSE 연결 요청을 통해 서버와 지속적인 연결을 하는 길을 만듭니다.
    - 연결 후 전송되는 알림이 없으면 503 에러가 발생하므로 연결하고 바로 더미데이터를 보내주도록 했습니다.
    - 재연결이 거의 발생할 일이 없지만 재연결이 발생하면 기존 클라이언트가 갖고있는 마지막으로 받았던 Event의 Id를 사용해 연결이 끊긴 동안 수신된 알림들을 수신합니다.
- 읽음 처리
    - 알림의 닫기나 승인/거절 버튼을 누르면 알림을 읽음처리하여 내 읽지 않은 알림 목록에서 사라집니다.
- 알림 직접 보내기
    - EventListener를 통한 알림 전송이 아닌 NotificationService를 사용한 알림만을 보내는 API로 독립적으로 알림 전송이 필요한 경우 사용됩니다.
    - 알림 타입에 따라 다른 알림이 생성되어 전송되도록 했습니다.
- API에 붙는 알림 보내기
    - 알림 서비스와 직접적으로 연결하는 걸 피하기 위해 EventListener를 사용했습니다. eventListener로 API에 필요한 알림을 만들어 전송할 수 있습니다.
- 로그인한 유저에 대한 읽지 않은 알림 목록 조회
    - 사용자는 본인이 확인하지 않은 동안에도 본인에게 온 알림을 저장하고 후에 확인할 수 있어야 한다고 생각했습니다.
    - 따라서 유저가 알림목록에서 유저에게 온 알림 중 읽지 않은 알림은 계속 조회가 되도록 했습니다.

## 📄ERD

![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/182f19c9-43e9-4f68-9073-da43faf966c4/99b76537-3826-4ba2-9242-fac5a5a92509/Untitled.png)

---

## 👩‍👩‍👧‍👧팀원 및 역할

### 박정은

- 채팅 기능 구현
- 관심/차단 기능
- 모집글 조회/수정
- 예외처리
- 서버 배포

### 심형철

- 알림기능
- refresh Token
- 로그인
- 회원가입
- 유저 상세 조회
- 프로필 수정
- 로그아웃
- CI/CD 진행중
- RDS+AZ+Replica
- 서버 환경 구축(EC2 + LoadBalancer..)
- 테스트 코드 작성(RepositoryTest branch)

### 이민우

- 후기 요구사항 정의
- 소셜로그인 (카카오)
- 채팅 기능 (STOMP)
- 로그인
- 회원가입
- 유저 상세 조회
- 태그 검색
- 데이터 처리 (Spring batch + Scheduer)

### 이상인

- 게시글 검색
- S3 이미지 업로드, 프로필 이미지 저장 및 조회
- 모집글 등록
- 모집들 삭제
- 모집글 조회
- 모집글 상태변경
- 모집글 페이징
- 모집한 게시글 조회
- 후기 요구사항 정의
- 지도 API 사용
- QueryDSL 사용

---

## 🌎배포

[willuapp.com](http://willuapp.com/)

---

## 📆개발 일정

---

> 8월 17일 ~ 8월 22일
> 
- 역할 분담, 계획 수립 및 프로젝트 생성
- 기본 (필수) 기능 구현

> 8월 23일 ~ 27일
> 
- 세부사항 조정
- 채팅 기능 구현
- 알림 기능 구현

> 8월 28일 ~ 8월 30일
> 
- 프론트엔드 1차 구현 (APi 작동 확인)
- 세부사항 조정
- 1차 배포

> 8월 30일 ~ 9월 1일
> 
- 프론트 엔드 2차 구현 (사용자 편의를 위한 조정)
- 세부사항 조정
- 2차 배포

> 9월 2일  ~ 9월 3일
> 
- 중간 발표 준비
- 프론트 엔드 보강
- 채팅 기능 보강 (개별 사용자 에게 메세지 보내기)

> 9월 4일  ~ 9월 7일
> 
- 중간 피드백 적용
    - 알림 기능 보강
- S3 사용 이미지 업로드

> 9월 8일 ~ 9월 12일
> 
- 추가 기능 구현
    - 태그 검색 기능
    - 지도 API 적용 (게시글 장소 지정)
- 3차 배포 (유저 테스트)

> 9월 13일 ~ 15일
> 
- 유저 피드백 반영 (프론트)
    - 신청 알림시 사이드바 활성화
    - 항목검색, 태그검색 모집중/모집완료 별 따로 검색
- 서버 고도화
    - 로드 밸런싱 적용
    - Replica 적용
    - Docker적용
    - 도메인 설정
    - HTTPS 적용
- 코드 리펙토링
    - QueryDSL 적용
    - 예외처리 AOP 적용

마지막 수정 날짜 : 2023-09-18
